#!/usr/bin/env bash

set -euf -o pipefail

HOST="i.jarv.org"
dir=$(dirname "$0")
site_dir="/var/opt/www/jarv.org"
public_dir="$dir"/../public

cd "$dir/.."
hugo --minify --cleanDestinationDir
find "$public_dir" -type f -print0 | xargs -0 gzip --keep
rsync --checksum --itemize-changes -r --exclude ".gitignore" --delete "${public_dir}/" root@$HOST:$site_dir
